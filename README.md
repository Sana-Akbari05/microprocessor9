# ریزپزدازنده جلسه 9 ام 
# ثنا اکبری
# IR , MQ9 , interrupt
**IR**
در این برنامه از یک سنسور مادون‌قرمز دیجیتال استفاده شده که وظیفه آن تشخیص حضور یا عدم حضور یک جسم در مقابل فرستنده و گیرنده‌ی IR است. این نوع سنسورها معمولاً دارای یک مقایسه‌کننده داخلی هستند که خروجی آن را تنها در قالب صفر و یک ارائه می‌کند. در بخش راه‌اندازی، پایه A0 به عنوان ورودی دیجیتال تعریف شده و نقش دریافت وضعیت سنسور را دارد. در کنار آن، یک LED روی پایه ۲ قرار گرفته تا نتیجه تشخیص سنسور را به‌صورت دیداری نمایش دهد. ارتباط سریال نیز فعال شده تا بتوان وضعیت تشخیص را در مانیتور سریال مشاهده کرد.

در حلقه اصلی، مقدار خروجی سنسور از طریق digitalRead دریافت می‌شود. معمولاً زمانی که جسمی در مقابل فرستنده قرار بگیرد، پرتو ارسال‌شده بازتاب شده و گیرنده آن را دریافت می‌کند و سنسور خروجی را به حالت صفر می‌برد. به همین دلیل در این برنامه مقدار صفر به معنای تشخیص یک جسم در نظر گرفته شده است. در این حالت، پیام مربوط به تشخیص جسم روی مانیتور سریال ارسال شده و LED روشن می‌شود تا این وضعیت به‌صورت لحظه‌ای مشخص باشد.

در حالت مقابل، وقتی مقدار خوانده‌شده یک است، یعنی سنسور بازتابی دریافت نکرده و جسمی در مقابل آن قرار نگرفته است. بنابراین پیام «تشخیص داده نشد» روی سریال ارسال شده و LED خاموش می‌شود. این روند در هر چرخه با یک تأخیر کوتاه تکرار می‌شود تا نتیجه‌ی سنسور با سرعت مناسب به‌روز شود.

این روش ساده و مستقیم باعث می‌شود بتوان از سنسور مادون‌قرمز برای کاربردهایی مثل شمارش اشیا، تشخیص عبور، یا ساخت مدارهای امنیتی کوچک استفاده کرد، بدون اینکه نیاز به پردازش آنالوگ یا تنظیمات پیچیده باشد.
مشاهده کد:
9/IR/IR.ino
مشاهده شماتیک:
![IR](https://github.com/user-attachments/assets/f18ea272-9eed-4c35-abe6-730162ae3232)
مشاهده خروجی:
https://github.com/user-attachments/assets/d986ccd1-c70e-4a08-b3df-90582c43f257
**MQ9**
در این برنامه از سنسور MQ9 برای تشخیص گازهای قابل اشتعال استفاده شده است. پایه خروجی سنسور به ورودی آنالوگ A0 متصل شده و مقدار آن از طریق تابع analogRead خوانده می‌شود. مقدار خوانده‌شده عددی بین صفر تا ۱۰۲۳ است که نشان‌دهنده شدت گاز موجود در محیط است. در ابتدای برنامه یک مقدار آستانه تعریف شده که با آن سنجیده می‌شود آیا غلظت گاز به حدی رسیده که به‌عنوان حالت هشدار در نظر گرفته شود یا نه. خروجی برنامه روی یک LED قرار گرفته که روی پین ۱۳ قرار دارد و در هنگام عبور مقدار سنسور از آستانه، روشن می‌شود.

در بخش راه‌اندازی، ارتباط سریال فعال شده تا بتوان مقدار خام سنسور و وضعیت آن را مشاهده کرد. همچنین پین LED به‌عنوان خروجی تنظیم شده است. در حلقه اصلی برنامه ابتدا مقدار ورودی از سنسور MQ9 خوانده می‌شود و همان مقدار برای بررسی و همچنین برای نمایش روی مانیتور سریال چاپ می‌شود. پس از این مرحله مقدار دریافت شده با مقدار آستانه‌ای که از قبل مشخص شده مقایسه می‌شود. اگر مقدار سنسور بزرگ‌تر از مقدار آستانه باشد، پیام هشدار روی سریال چاپ می‌شود و LED روشن می‌شود تا وجود گاز اعلام شود. اگر مقدار کمتر از حد تعیین‌شده باشد، LED خاموش می‌ماند.

این روند هر بار پس از یک وقفه یک‌ثانیه‌ای تکرار می‌شود تا سنسور فرصت تثبیت داشته باشد و همچنین داده‌ها با فاصله زمانی قابل مشاهده چاپ شوند. عملکرد کلی برنامه بر این پایه است که سنسور MQ9 مقدار غلظت گازهای CO و گازهای قابل اشتعال را به‌صورت یک خروجی آنالوگ ارائه می‌دهد و برنامه با یک مقایسه ساده مشخص می‌کند آیا مقدار خوانده‌شده در محدوده ایمن قرار دارد یا به حالت هشدار رسیده است. این روش یکی از ساده‌ترین و پایه‌ای‌ترین روش‌ها برای استفاده از MQ9 است و برای آزمایش اولیه یا پایش مقدماتی کیفیت هوا کاربرد کاملاً مناسبی دارد.
مشاهده کد:
9/MQ9/MQ9.ino
مشاهده شماتیک:
<img width="1018" height="683" alt="MQ9" src="https://github.com/user-attachments/assets/466af2d5-4cf7-4daf-80de-f10cc1e91cf7" />
مشاهده خروجی:


https://github.com/user-attachments/assets/892b3319-a734-4cc6-abdc-87951684707b



**MQ9_digital**
در این برنامه از خروجی دیجیتال سنسور MQ9 استفاده شده که برخلاف خروجی آنالوگ، مقدار آن تنها دو حالت صفر و یک دارد. این خروجی زمانی فعال می‌شود که غلظت گاز از حد آستانه‌ای که روی ماژول توسط پتانسیومتر داخلی تنظیم شده عبور کند. پایه دیجیتال سنسور به پین ۲ آردوینو متصل شده و مقدار آن در هر بار اجرای حلقه خوانده می‌شود. در کنار آن، یک LED روی پین ۱۳ قرار دارد که برای نمایش وضعیت تشخیص گاز به کار می‌رود.

در بخش راه‌اندازی، پایه ورودی دیجیتال سنسور و پایه مربوط به LED مقداردهی اولیه می‌شوند و همچنین ارتباط سریال راه‌اندازی می‌شود تا پیام‌های اطلاع‌رسانی روی مانیتور سریال نمایش داده شوند. با شروع حلقه اصلی، مقدار دیجیتال خروجی سنسور از طریق digitalRead دریافت می‌شود. این مقدار یا صفر است یا یک؛ که یک به معنای عبور از آستانه و فعال شدن بخش مقایسه‌کننده داخلی سنسور است.

هنگامی که مقدار ورودی برابر یک باشد، یعنی سنسور افزایش غلظت گاز را تشخیص داده و وارد حالت هشدار شده است. در این شرایط پیام هشدار روی سریال ارسال می‌شود و LED خاموش می‌ماند. در حالت مقابل، زمانی که مقدار خوانده‌شده صفر باشد، یعنی غلظت گاز کمتر از حد تعیین‌شده است و وضعیت محیط از نظر سنسور ایمن تشخیص داده می‌شود؛ در این حالت LED روشن نگه داشته می‌شود تا حالت عادی مشخص باشد.

این روند با هر بار تاخیر نیم‌ثانیه‌ای تکرار می‌شود. تفاوت اصلی این برنامه با نسخه آنالوگ این است که تنظیم حساسیت سنسور در اینجا به عهده پتانسیومتر داخلی ماژول است و آردوینو تنها نتیجه خروجی مقایسه‌کننده را دریافت می‌کند. بنابراین برنامه بسیار ساده‌تر بوده و برای کاربردهایی که فقط نیاز به تشخیص وجود یا عدم وجود گاز دارند مناسب است.
مشاهده کد:
9/MQ9_digital/MQ9_digital.ino
مشاهده شماتیک:
<img width="1018" height="683" alt="MQ9" src="https://github.com/user-attachments/assets/1ca283fb-b1be-4c5a-946f-24fe5eeb1d97" />
مشاهده خروجی:



https://github.com/user-attachments/assets/79aa5add-e9d6-4c95-998d-a5c0f6e54795

**interrupt**
در این برنامه از وقفه‌های خارجی میکروکنترلر استفاده شده تا بتوان تنها با تغییر وضعیت یک ورودی، خروجی را بدون نیاز به نظارت دائم در حلقه اصلی کنترل کرد. در ابتدا پین ۲ به‌عنوان ورودی وقفه انتخاب شده و یک متغیر به‌نام state برای ذخیره‌سازی وضعیت خروجی تعریف شده است. این متغیر به‌صورت volatile نوشته شده تا پردازنده در هنگام اجرای وقفه مقدار آن را همواره از حافظه اصلی دریافت کند و دچار خطا در مقداردهی نشود. در ادامه پین ۱۳ که برای LED در نظر گرفته شده به حالت خروجی تنظیم می‌شود و سپس وقفه مربوط به پین ۲ فعال می‌شود. نوع وقفه از نوع CHANGE است، یعنی با هر تغییری از سطح صفر به یک یا یک به صفر در پین ورودی، وقفه فراخوانی می‌شود.

حلقه اصلی برنامه فقط وظیفه دارد مقدار state را روی پین ۱۳ اعمال کند تا LED مطابق آن روشن یا خاموش بماند. این بخش عملاً هیچ پردازش اضافه‌ای انجام نمی‌دهد و تنها بازتاب دهنده تغییراتی است که در وقفه اتفاق می‌افتد. بخش اصلی برنامه در تابع blink قرار دارد که همان تابع وقفه یا ISR است. هر بار که روی پین ۲ تغییری رخ دهد، این تابع اجرا می‌شود و مقدار state را معکوس می‌کند. به این ترتیب هر بار که کلید متصل به پین ۲ فشار داده یا رها شود، مقدار خروجی تغییر می‌کند و LED حالت جدید خود را می‌گیرد.

نکته مهم این است که کل روند تغییر وضعیت LED وابسته به وقفه است و نه حلقه loop. در نتیجه حتی اگر حلقه اصلی درگیر پردازش‌های طولانی باشد، تغییر وضعیت LED بدون تأخیر و مستقل از روند برنامه انجام خواهد شد. این ویژگی استفاده از وقفه را در پروژه‌هایی که نیاز به واکنش سریع دارند ضروری می‌کند. در این برنامه تنها با چند خط کد می‌توان نشان داد که چگونه با هر تغییر کوچک در یک ورودی، خروجی به‌سرعت واکنش نشان می‌دهد و نکته کلیدی در این روش، استفاده از متغیر volatile و تابع attachInterrupt برای مدیریت صحیح جریان برنامه و وقفه است.
مشاهده کد:
9/interrupt/interrupt.ino
مشاهده شماتیک:
<img width="557" height="618" alt="interrupt" src="https://github.com/user-attachments/assets/d6fe4bb2-61d3-4d6f-95c3-b6c1fab101e7" />
مشاهده خروجی:


https://github.com/user-attachments/assets/e72e2fdc-368e-4cd4-a7a1-5034831f2505




